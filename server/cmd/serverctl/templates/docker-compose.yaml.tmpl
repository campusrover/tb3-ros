{{- define "docker-compose" }}
{{- "# Code generated by serverctl. DO NOT EDIT." }}
version: '3.7'
services:
  {{ template "relay" .Relay }}
  {{ template "proxy" .Proxy }}
  {{- with .DesktopList }}
    {{ range . }}
      {{ template "desktop" . }}
    {{ end }}
  {{ end }}
networks:
{{- with .Network }}
  {{ .Name }}:
    ipam:
      driver: default
      config:
        - subnet: {{ .Subnet }}
{{ end }}
volumes:
  tailscale-data:
  {{- with .DesktopList }}
    {{- range . }}
      {{ template "desktop-volume" .Volume }}
    {{- end }}
  {{ end }}
{{ end -}}
